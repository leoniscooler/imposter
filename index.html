<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Imposter Game</title>

 <style>
    * { 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f4f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #222;
      padding: 12px;
    }

    .container {
      width: 100%;
      max-width: 800px;
      min-width: 280px;
      padding: 16px 12px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    h1 {
      text-align: center;
      margin: 0 0 8px;
      font-size: clamp(24px, 5vw, 32px);
      font-weight: 800;
      line-height: 1.2;
      padding: 0 8px;
      width: 100%;
      position: relative;
    }

    .info-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      border: none;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
      transition: all 0.2s;
    }

    .info-btn:hover {
      transform: translateY(-50%) scale(1.1);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
    }

    .info-btn:active {
      transform: translateY(-50%) scale(0.95);
    }

    @media (max-width: 480px) {
      .info-btn {
        width: 32px;
        height: 32px;
        font-size: 18px;
        right: 4px;
      }
    }

    p.instructions {
      margin: 0 0 20px;
      text-align: center;
      font-size: clamp(14px, 3.5vw, 16px);
      color: #555;
      line-height: 1.4;
      padding: 0 8px;
      max-width: 600px;
      width: 100%;
    }

    /* ===== Modal Styles ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: 20px;
      max-width: 700px;
      width: 100%;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: translateY(20px);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      padding: 24px 24px 16px;
      border-bottom: 2px solid #eef2ff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 24px;
      color: #4f46e5;
      font-weight: 800;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 28px;
      color: #666;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: #f3f4f6;
      color: #dc2626;
    }

    .modal-content {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-section {
      margin-bottom: 28px;
    }

    .modal-section h3 {
      margin: 0 0 16px;
      font-size: 20px;
      color: #333;
      font-weight: 700;
      padding-bottom: 8px;
      border-bottom: 2px solid #eef2ff;
    }

    .modal-section p {
      margin: 0 0 16px;
      line-height: 1.6;
      color: #444;
    }

    .modal-section ul, .modal-section ol {
      margin: 0 0 16px;
      padding-left: 24px;
    }

    .modal-section li {
      margin-bottom: 10px;
      line-height: 1.5;
      color: #444;
    }

    .role-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    @media (max-width: 700px) {
      .role-grid {
        grid-template-columns: 1fr;
      }
    }

    .role-card {
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #4f46e5;
    }

    .role-card.civilian {
      border-left-color: #3b82f6;
    }

    .role-card.imposter {
      border-left-color: #dc2626;
    }

    .role-card.detective {
      border-left-color: #10b981;
    }

    .role-card.jester {
      border-left-color: #f59e0b;
    }

    .role-card.assassin {
      border-left-color: #8b5cf6;
    }

    .role-card h4 {
      margin: 0 0 12px;
      font-size: 18px;
      font-weight: 700;
      color: #111;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .role-card .role-icon {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .civilian .role-icon {
      background: #3b82f6;
    }

    .imposter .role-icon {
      background: #dc2626;
    }

    .detective .role-icon {
      background: #10b981;
    }

    .jester .role-icon {
      background: #f59e0b;
    }

    .assassin .role-icon {
      background: #8b5cf6;
    }

    .role-card p {
      margin: 0 0 12px;
      font-size: 15px;
      line-height: 1.5;
      color: #444;
    }

    .role-card .goal {
      font-weight: 600;
      color: #111;
      background: #eef2ff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      margin-top: 8px;
    }

    /* ===== Subject Selection ===== */
    .subject-section {
      width: 100%;
      max-width: 500px;
      margin-bottom: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .subject-section h2 {
      margin: 0 0 16px;
      text-align: center;
      font-size: clamp(18px, 4vw, 20px);
      color: #333;
      font-weight: 700;
    }

    .subject-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
      width: 100%;
    }

    @media (max-width: 500px) {
      .subject-options {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }

    .subject-option {
      padding: 14px 10px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: #f9fafb;
      text-align: center;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: #4b5563;
      width: 100%;
    }

    .subject-option:hover {
      background: #f3f4f6;
      transform: translateY(-2px);
      border-color: #d1d5db;
    }

    .subject-option.selected {
      background: #e0e7ff;
      border-color: #4f46e5;
      color: #4f46e5;
      box-shadow: 0 4px 8px rgba(79, 70, 229, 0.1);
    }

    .custom-subject-container {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
      width: 100%;
    }

    .custom-subject-input {
      display: flex;
      gap: 10px;
      align-items: center;
      width: 100%;
    }

    @media (max-width: 480px) {
      .custom-subject-input {
        flex-direction: column;
      }
    }

    .custom-subject-input input {
      flex: 1;
      padding: 12px;
      font-size: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      transition: border-color 0.2s;
      min-width: 0;
    }

    .custom-subject-input input:focus {
      outline: none;
      border-color: #4f46e5;
    }

    .custom-subject-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #10b981, #34d399);
      color: white;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      transition: transform 0.12s ease, box-shadow 0.2s;
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.25);
    }

    @media (max-width: 480px) {
      .custom-subject-btn {
        width: 100%;
      }
    }

    .custom-subject-btn:hover {
      box-shadow: 0 6px 12px rgba(16, 185, 129, 0.3);
    }

    .custom-subject-btn:active {
      transform: scale(0.96);
    }

    .selected-subject-display {
      text-align: center;
      margin: 20px 0;
      padding: 16px;
      background: linear-gradient(135deg, #e0e7ff, #f3f4f6);
      border-radius: 14px;
      border: 2px solid #4f46e5;
      width: 100%;
    }

    .selected-subject-display h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: #6b7280;
      font-weight: 600;
    }

    .selected-subject-display .subject-name {
      font-size: clamp(20px, 4vw, 22px);
      font-weight: 800;
      color: #4f46e5;
      margin: 0;
      word-break: break-word;
    }

    .change-subject-btn {
      display: block;
      margin: 8px auto 0;
      padding: 8px 16px;
      border: none;
      border-radius: 999px;
      background: #f3f4f6;
      color: #6b7280;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: fit-content;
    }

    .change-subject-btn:hover {
      background: #e5e7eb;
      color: #4b5563;
    }

    /* ===== Player Names Section ===== */
    .player-names-section {
      width: 100%;
      max-width: 500px;
      margin-bottom: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: none; /* Hidden by default */
    }

    .player-names-section h2 {
      margin: 0 0 16px;
      text-align: center;
      font-size: clamp(18px, 4vw, 20px);
      color: #333;
      font-weight: 700;
    }

    .player-names-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #eef2ff;
    }

    .player-names-header h3 {
      margin: 0;
      font-size: 16px;
      color: #4f46e5;
      font-weight: 700;
    }

    .player-names-buttons {
      display: flex;
      gap: 8px;
    }

    .randomize-names-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 999px;
      background: #e0e7ff;
      color: #4f46e5;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .randomize-names-btn:hover {
      background: #c7d2fe;
      transform: translateY(-1px);
    }

    .reset-names-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 999px;
      background: #fee2e2;
      color: #dc2626;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .reset-names-btn:hover {
      background: #fecaca;
      transform: translateY(-1px);
    }

    .player-names-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
      width: 100%;
    }

    @media (max-width: 500px) {
      .player-names-list {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }

    .player-name-input-container {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .player-name-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
      text-align: center;
    }

    .player-name-input {
      padding: 12px;
      font-size: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      text-align: center;
      transition: border-color 0.2s;
      width: 100%;
    }

    .player-name-input:focus {
      outline: none;
      border-color: #4f46e5;
    }

    /* ===== Controls ===== */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      background: #fff;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 500px;
    }

    .controls > div {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 120px;
      max-width: 200px;
    }

    @media (max-width: 480px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }
      
      .controls > div {
        max-width: 100%;
        min-width: 0;
      }
    }

    .controls label {
      font-size: 14px;
      color: #444;
      margin-bottom: 6px;
      font-weight: 600;
      text-align: center;
    }

    .controls input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 10px;
      text-align: center;
      transition: border-color 0.2s;
    }

    .controls input:focus {
      outline: none;
      border-color: #4f46e5;
    }

    /* Role toggle styling */
    .role-toggle {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      min-width: 120px;
      max-width: 200px;
      padding: 12px 0;
    }

    .role-toggle label {
      margin-bottom: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      color: #444;
      font-weight: 600;
    }

    .role-toggle input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin: 0;
      cursor: pointer;
    }

    .detective-toggle input[type="checkbox"] {
      accent-color: #10b981;
    }

    .jester-toggle input[type="checkbox"] {
      accent-color: #f59e0b;
    }

    .assassin-toggle input[type="checkbox"] {
      accent-color: #8b5cf6;
    }

    @media (max-width: 480px) {
      .role-toggle {
        max-width: 100%;
      }
    }

    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
      text-align: center;
      transition: transform 0.12s ease, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
      margin-top: 8px;
    }

    .btn:hover {
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
    }

    .btn:active {
      transform: scale(0.96);
    }

    .btn:disabled {
      background: linear-gradient(135deg, #9ca3af, #d1d5db);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .error {
      text-align: center;
      color: #dc2626;
      min-height: 20px;
      font-size: 14px;
      font-weight: 500;
      margin: 8px 0 16px;
      width: 100%;
      padding: 0 12px;
      max-width: 500px;
    }

    /* ===== Cards ===== */
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-top: 16px;
      width: 100%;
      max-width: 1000px;
      justify-items: center;
    }

    @media (max-width: 600px) {
      .cards {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
      }
    }

    @media (max-width: 400px) {
      .cards {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 8px;
      }
    }

    @media (max-width: 350px) {
      .cards {
        grid-template-columns: 1fr;
        max-width: 280px;
      }
    }

    .card {
      background: #fff;
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 8px;
      user-select: none;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
      max-width: 200px;
    }

    @media (max-width: 600px) {
      .card {
        max-width: 180px;
      }
    }

    @media (max-width: 400px) {
      .card {
        max-width: 160px;
        padding: 12px;
      }
    }

    @media (max-width: 350px) {
      .card {
        max-width: 100%;
      }
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(14px, 3vw, 16px);
      font-weight: 700;
    }

    .status-label {
      font-size: 11px;
      text-transform: uppercase;
      color: #777;
      font-weight: 600;
      letter-spacing: 0.5px;
      transition: color 0.15s;
    }

    /* ===== Word box ===== */
    .word-box {
      padding: 16px 10px;
      border-radius: 12px;
      border: 1px dashed #bbb;
      text-align: center;
      font-size: clamp(16px, 4vw, 20px);
      font-weight: 800;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.25s, transform 0.25s;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      word-break: break-word;
      overflow-wrap: break-word;
      width: 100%;
    }

    @media (max-width: 400px) {
      .word-box {
        min-height: 54px;
        padding: 12px 8px;
      }
    }

    .word-hidden { 
      color: #777; 
    }
    
    .word-revealed { 
      color: #111; 
      opacity: 1; 
      transform: scale(1); 
    }

    .word-locked {
      color: #999;
      font-style: italic;
      opacity: 1;
      transform: scale(1);
      font-size: 18px;
    }

    /* ===== Role styling ===== */
    .detective-role {
      color: #10b981;
      font-size: 14px;
      font-weight: 700;
      margin-top: 4px;
      text-align: center;
      line-height: 1.3;
    }

    .jester-role {
      color: #f59e0b;
      font-size: 14px;
      font-weight: 700;
      margin-top: 4px;
      text-align: center;
      line-height: 1.3;
    }

    .assassin-role {
      color: #8b5cf6;
      font-size: 14px;
      font-weight: 700;
      margin-top: 4px;
      text-align: center;
      line-height: 1.3;
    }

    /* ===== Category box ===== */
    .category-box {
      padding: 10px 12px;
      border-radius: 10px;
      background: #eef2ff;
      text-align: center;
      font-size: clamp(14px, 3.5vw, 16px);
      font-weight: 600;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.25s, transform 0.25s;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      word-break: break-word;
      width: 100%;
    }

    @media (max-width: 400px) {
      .category-box {
        min-height: 40px;
        padding: 8px 10px;
      }
    }

    .category-shown {
      opacity: 1;
      transform: translateY(0);
    }

    /* ===== Button ===== */
    .card-btn {
      padding: 12px 14px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
      color: #333;
      margin-top: 4px;
    }

    .card-btn:active {
      transform: scale(0.96);
    }

    .card-btn.locked {
      background: #d1d5db;
      color: #6b7280;
      cursor: default;
      transform: none;
      opacity: 0.8;
    }

    /* ===== Detective/Assassin/Jester hint styling ===== */
    .detective-hint,
    .assassin-hint,
    .jester-hint {
      font-size: 13px;
      font-weight: 600;
      margin-top: 6px;
      text-align: center;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid;
      line-height: 1.4;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.25s, transform 0.25s;
    }

    .detective-hint {
      color: #10b981;
      background: #f0fdf4;
      border-color: #bbf7d0;
    }

    .assassin-hint {
      color: #8b5cf6;
      background: #f5f3ff;
      border-color: #ddd6fe;
    }

    .jester-hint {
      color: #f59e0b;
      background: #fef3c7;
      border-color: #fde68a;
    }

    .detective-hint.show,
    .assassin-hint.show,
    .jester-hint.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ===== Status Section ===== */
    .status-section {
      margin-top: 28px;
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .reveal-tracker {
      text-align: center;
      margin-bottom: 20px;
      font-size: clamp(16px, 4vw, 20px);
      font-weight: 800;
      color: #4f46e5;
      min-height: 32px;
      padding: 16px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
    }

    .first-player {
      text-align: center;
      padding: 20px 16px;
      background: linear-gradient(135deg, #4f46e5, #8b5cf6);
      color: white;
      border-radius: 18px;
      font-size: clamp(18px, 5vw, 24px);
      font-weight: 900;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s, transform 0.5s;
      box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
      width: 100%;
      line-height: 1.3;
      margin-bottom: 16px;
    }

    .first-player.show {
      opacity: 1;
      transform: translateY(0);
    }

    .reveal-roles-btn {
      padding: 14px 24px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
      text-align: center;
      transition: transform 0.12s ease, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);
      margin-bottom: 16px;
    }

    .reveal-roles-btn:hover {
      box-shadow: 0 6px 16px rgba(245, 158, 11, 0.3);
    }

    .reveal-roles-btn:active {
      transform: scale(0.96);
    }

    .reveal-roles-btn:disabled {
      background: linear-gradient(135deg, #9ca3af, #d1d5db);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    /* ===== Roles Reveal Box - Updated to match page style ===== */
    .roles-reveal-box {
      text-align: center;
      padding: 0;
      background: #fff;
      color: #222;
      border-radius: 16px;
      font-size: clamp(16px, 4vw, 18px);
      font-weight: 600;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s, transform 0.5s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      line-height: 1.4;
      margin-bottom: 16px;
      max-height: 0;
      overflow: hidden;
      border: 2px solid #4f46e5;
    }

    .roles-reveal-box.show {
      opacity: 1;
      transform: translateY(0);
      max-height: 600px;
      transition: opacity 0.5s, transform 0.5s, max-height 0.5s;
    }

    .roles-reveal-header {
      padding: 20px 16px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      border-radius: 14px 14px 0 0;
      margin: 0;
    }

    .roles-reveal-header h3 {
      margin: 0;
      font-size: clamp(18px, 4vw, 22px);
      font-weight: 800;
    }

    .roles-reveal-content {
      padding: 20px;
    }

    .role-list {
      text-align: left;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .role-list li {
      margin-bottom: 12px;
      padding: 14px 16px;
      background: #f9fafb;
      border-radius: 12px;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.2s, box-shadow 0.2s;
      border-left: 4px solid #4f46e5;
    }

    .role-list li:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .role-list .player-number {
      font-weight: 800;
      margin-right: 10px;
      color: #4f46e5;
      font-size: 16px;
      min-width: 80px;
    }

    .role-list .role-name {
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 8px;
      background: #eef2ff;
      color: #4f46e5;
      font-size: 14px;
      flex: 1;
      text-align: center;
    }

    .role-list .civilian-role {
      background: #e0e7ff;
      color: #3b82f6;
      border-left-color: #3b82f6;
    }

    .role-list .imposter-role {
      background: #fee2e2;
      color: #dc2626;
      border-left-color: #dc2626;
    }

    .role-list .detective-role {
      background: #d1fae5;
      color: #10b981;
      border-left-color: #10b981;
    }

    .role-list .jester-role {
      background: #fef3c7;
      color: #f59e0b;
      border-left-color: #f59e0b;
    }

    .role-list .assassin-role {
      background: #f5f3ff;
      color: #8b5cf6;
      border-left-color: #8b5cf6;
    }

    .assassin-target {
      font-size: 12px;
      color: #8b5cf6;
      font-weight: 600;
      margin-top: 4px;
      background: rgba(139, 92, 246, 0.1);
      padding: 4px 8px;
      border-radius: 6px;
      display: inline-block;
    }

    .footer-note {
      margin-top: 24px;
      text-align: center;
      font-size: 13px;
      color: #666;
      padding: 0 12px;
      line-height: 1.5;
      max-width: 500px;
      width: 100%;
    }

    /* Toggle for player names */
    .toggle-player-names {
      margin: 8px 0 0;
      padding: 8px 16px;
      border: none;
      border-radius: 999px;
      background: #e0e7ff;
      color: #4f46e5;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: fit-content;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .toggle-player-names:hover {
      background: #c7d2fe;
      transform: translateY(-1px);
    }

    /* Small screen optimizations */
    @media (max-width: 480px) {
      body {
        padding: 8px;
        align-items: flex-start;
      }
      
      .container {
        padding: 12px 8px 20px;
      }
      
      .subject-section {
        padding: 16px;
      }
      
      .player-names-section {
        padding: 16px;
      }
      
      .controls {
        padding: 14px;
        gap: 16px;
      }
      
      .subject-options {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .player-names-list {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .modal {
        max-height: 90vh;
      }
      
      .modal-header {
        padding: 20px 20px 16px;
      }
      
      .modal-content {
        padding: 20px;
      }
      
      .modal-header h2 {
        font-size: 20px;
      }
      
      .role-list li {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .role-list .player-number {
        margin-right: 0;
        min-width: auto;
        width: 100%;
      }
      
      .role-list .role-name {
        width: 100%;
        text-align: left;
      }
      
      .roles-reveal-content {
        padding: 16px;
      }
    }

    /* Very small screen adjustments */
    @media (max-width: 350px) {
      .subject-options {
        grid-template-columns: 1fr;
      }
      
      .player-names-list {
        grid-template-columns: 1fr;
      }
      
      .card-header {
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
      }
      
      .status-label {
        align-self: flex-end;
      }
      
      .role-list li {
        padding: 12px;
      }
    }

    /* Ensure everything stays within viewport */
    @media (max-height: 700px) and (orientation: portrait) {
      body {
        align-items: flex-start;
        padding-top: 4px;
      }
      
      .container {
        padding-top: 8px;
      }
      
      h1 {
        margin-bottom: 4px;
      }
      
      .instructions {
        margin-bottom: 12px;
      }
    }

    /* Landscape optimization */
    @media (max-height: 500px) and (orientation: landscape) {
      body {
        padding: 4px;
        align-items: flex-start;
      }
      
      .container {
        padding: 8px 6px 12px;
      }
      
      .cards {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 8px;
        margin-top: 12px;
      }
      
      .card {
        max-width: 160px;
        padding: 10px;
      }
      
      .word-box {
        min-height: 48px;
        padding: 10px 6px;
      }
      
      .category-box {
        min-height: 36px;
        padding: 6px 8px;
      }
      
      .roles-reveal-box {
        max-height: 400px;
        overflow-y: auto;
      }
    }
  </style>
</head>

<body>
<div class="container">

  <h1>
    Imposter Game
    <button class="info-btn" id="infoBtn">i</button>
  </h1>
  <p class="instructions">
    You get a word + category. Imposters see the category, too.<br>
    Cards can only be opened once.
  </p>

  <!-- Info Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h2>How to Play Imposter Game</h2>
        <button class="close-btn" id="closeModalBtn">&times;</button>
      </div>
      <div class="modal-content">
        
        <div class="modal-section">
          <h3>Rules</h3>
          <ol>
            <li><strong>Setup:</strong> Choose a subject, number of players, and imposters</li>
            <li><strong>Secret Word:</strong> All players get a secret word from the chosen subject</li>
            <li><strong>Category:</strong> Everyone also sees the category of the secret word</li>
            <li><strong>Imposters:</strong> Some players are imposters - they DON'T know the secret word!</li>
            <li><strong>Discussion:</strong> Players discuss to figure out who the imposters are by saying a word related to the secret word they got</li>
            <li><strong>Voting:</strong> Vote to eliminate suspected imposters</li>
            <li><strong>Winning:</strong> Civilians win if all imposters are eliminated. Imposters win if they survive. Jester wins if he/she gets voted out. Assassin wins if their target gets voted out.</li>
          </ol>
        </div>
		
        <div class="modal-section">
          <h3>Cards</h3>
          <div class="role-grid">
            
            <div class="role-card civilian">
              <h4>
                <span class="role-icon">C</span>
                Civilian
              </h4>
              <p>You know the secret word and its category. Your goal is to identify and vote out the imposters.</p>
              <div class="goal">Goal: Eliminate imposters</div>
            </div>

            <div class="role-card imposter">
              <h4>
                <span class="role-icon">I</span>
                Imposter
              </h4>
              <p>You DON'T know the secret word! You only see the category. Pretend you know the word to blend in.</p>
              <div class="goal">Goal: Don't get eliminated</div>
            </div>

            <div class="role-card detective">
              <h4>
                <span class="role-icon">D</span>
                Detective
              </h4>
              <p>You know the secret word. When you reveal your card, you get to peek at one random player's role.</p>
              <div class="goal">Goal: Help civilians find imposters</div>
            </div>

            <div class="role-card jester">
              <h4>
                <span class="role-icon">J</span>
                Jester
              </h4>
              <p>You know the secret word. Your goal is to get voted out by acting suspiciously without being obvious.</p>
              <div class="goal">Goal: Get voted out during discussion</div>
            </div>

            <div class="role-card assassin">
              <h4>
                <span class="role-icon">A</span>
                Assassin
              </h4>
              <p>You know the secret word. You're assigned a specific player to eliminate. Make sure THEY get voted out!</p>
              <div class="goal">Goal: Get your target player voted out</div>
            </div>

          </div>
        </div>

        <div class="modal-section">
          <h3>Gameplay</h3>
          <ol>
            <li><strong>Preparation:</strong> Host sets up the game with desired options</li>
            <li><strong>Card Distribution:</strong> Each player views their card ONCE on the device</li>
            <li><strong>Discussion:</strong> Players discuss - imposters must bluff convincingly</li>
            <li><strong>Questioning:</strong> Ask about the secret word to find inconsistencies</li>
            <li><strong>Voting:</strong> Vote for who you think is an imposter</li>
            <li><strong>Reveal:</strong> Eliminated player reveals their role</li>
            <li><strong>Repeat:</strong> Continue until either side wins</li>
          </ol>
        </div>

        <div class="modal-section">
          <h3>Tips</h3>
          <ul>
            <li><strong>Civilians:</strong> Give specific yet unrevealing words. Imposters often give vague answers.</li>
            <li><strong>Imposters:</strong> Listen carefully to what others say and build on their descriptions.</li>
            <li><strong>Detective:</strong> Use your peek information wisely - don't reveal it too early.</li>
            <li><strong>Jester:</strong> Act suspicious but not obviously fake. You want to be voted out, not ignored.</li>
            <li><strong>Assassin:</strong> Frame your target without being obvious. Work with imposters if possible.</li>
          </ul>
        </div>

		leoniscool.com

      </div>
    </div>
  </div>

  <div class="subject-section" id="subjectSection">
    <h2>Choose a Subject</h2>
    
    <div id="subjectDisplay" class="selected-subject-display" style="display: none;">
      <h3>Selected Subject:</h3>
      <div class="subject-name" id="selectedSubjectName"></div>
      <button class="change-subject-btn" id="changeSubjectBtn">Change Subject</button>
    </div>
    
    <div id="subjectSelection">
      <div class="subject-options" id="subjectOptions">
        <!-- Subjects will be added here by JavaScript -->
      </div>
      
      <div class="custom-subject-container">
        <div class="custom-subject-input">
          <input type="text" id="customSubjectInput" placeholder="Enter any word or phrase...">
          <button class="custom-subject-btn" id="customSubjectBtn">Use Custom</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Player Names Section -->
  <div class="player-names-section" id="playerNamesSection">
    <h2>Customize Player Names</h2>
    
    <div class="player-names-header">
      <h3>Players (Click to Edit)</h3>
      <div class="player-names-buttons">
        <button class="randomize-names-btn" id="randomizeNamesBtn">Randomize</button>
        <button class="reset-names-btn" id="resetNamesBtn">Reset</button>
      </div>
    </div>
    
    <div class="player-names-list" id="playerNamesList">
      <!-- Player name inputs will be added here by JavaScript -->
    </div>
    
    <button class="toggle-player-names" id="hidePlayerNamesBtn">Hide Player Names</button>
  </div>

  <div class="controls">
    <div>
      <label>Players</label>
      <input id="playerCount" type="number" min="3" max="20" value="3">
    </div>

    <div>
      <label>Imposters</label>
      <input id="imposterCount" type="number" min="1" max="10" value="1">
    </div>

    <div class="role-toggle detective-toggle">
      <label>
        <input id="detectiveToggle" type="checkbox">
        Detective
      </label>
    </div>

    <div class="role-toggle jester-toggle">
      <label>
        <input id="jesterToggle" type="checkbox">
        Jester
      </label>
    </div>

    <div class="role-toggle assassin-toggle">
      <label>
        <input id="assassinToggle" type="checkbox">
        Assassin
      </label>
    </div>

    <button id="generateBtn" class="btn" disabled>Deal Cards</button>
    
    <button class="toggle-player-names" id="showPlayerNamesBtn">Customize Player Names</button>
  </div>

  <div id="error" class="error"></div>
  
  <div id="cardsContainer" class="cards"></div>
  
  <!-- Status section moved to bottom -->
  <div class="status-section">
    <div id="revealTracker" class="reveal-tracker"></div>
    <div id="firstPlayer" class="first-player"></div>
    <button id="revealRolesBtn" class="reveal-roles-btn" style="display: none;">Reveal All Roles</button>
    <div id="rolesRevealBox" class="roles-reveal-box"></div>
  </div>

  <div class="footer-note">
    Close your card before passing the device.
  </div>
  <div class="footer-note">
    leoniscool.com
  </div>

</div>

<script>
/* ====== GAME STATE ===== */
let currentSubject = "";
let actualCustomSubject = ""; // Stores the actual custom word
let customItems = [];
let totalCards = 0;
let revealedCards = 0;
let lockedCards = 0;
let playerNumbers = [];
let words = []; // Store words globally for detective peek
let secretItem = ""; // Store secret item globally for detective
let secretCategory = ""; // Store secret category globally for detective
let assassinTarget = null; // Store assassin's target
let playerNames = []; // Store custom player names

/* ===== ELEMENTS ===== */
const cardsContainer = document.getElementById("cardsContainer");
const generateBtn = document.getElementById("generateBtn");
const playerCountInput = document.getElementById("playerCount");
const imposterCountInput = document.getElementById("imposterCount");
const detectiveToggle = document.getElementById("detectiveToggle");
const jesterToggle = document.getElementById("jesterToggle");
const assassinToggle = document.getElementById("assassinToggle");
const errorBox = document.getElementById("error");
const revealTracker = document.getElementById("revealTracker");
const firstPlayerBox = document.getElementById("firstPlayer");
const revealRolesBtn = document.getElementById("revealRolesBtn");
const rolesRevealBox = document.getElementById("rolesRevealBox");
const subjectSection = document.getElementById("subjectSection");
const subjectOptions = document.getElementById("subjectOptions");
const subjectDisplay = document.getElementById("subjectDisplay");
const subjectSelection = document.getElementById("subjectSelection");
const selectedSubjectName = document.getElementById("selectedSubjectName");
const changeSubjectBtn = document.getElementById("changeSubjectBtn");
const customSubjectInput = document.getElementById("customSubjectInput");
const customSubjectBtn = document.getElementById("customSubjectBtn");

// Player names elements
const playerNamesSection = document.getElementById("playerNamesSection");
const playerNamesList = document.getElementById("playerNamesList");
const randomizeNamesBtn = document.getElementById("randomizeNamesBtn");
const resetNamesBtn = document.getElementById("resetNamesBtn");
const hidePlayerNamesBtn = document.getElementById("hidePlayerNamesBtn");
const showPlayerNamesBtn = document.getElementById("showPlayerNamesBtn");

// Modal elements
const infoBtn = document.getElementById("infoBtn");
const modalOverlay = document.getElementById("modalOverlay");
const closeModalBtn = document.getElementById("closeModalBtn");

/* ===== DEFAULT SUBJECTS ===== */
const defaultSubjects = {
  "Clash Royale": {
    troops: ["Archers","Archer Queen","Baby Dragon","Balloon","Bandit","Barbarians","Bats","Battle Healer","Battle Ram",
      "Berserker","Bomber","Boss Bandit","Bowler","Bush Goblins","Cannon Cart","Cursed Hog","Dark Prince","Dart Goblin",
      "Electro Dragon","Electro Giant","Electro Spirit","Electro Wizard","Elite Barbarians","Elixir Blob","Elixir Golem",
      "Elixir Golemite","Executioner","Firecracker","Fire Spirit","Fisherman","Flying Machine","Furnace","Giant",
      "Giant Skeleton","Goblin Brawler","Goblin Gang","Goblin Demolisher","Goblin Giant","Goblin Machine","Goblins",
      "Goblinstein","Golden Knight","Golem","Golemite","Guardienne","Guards","Hog Rider","Hunter","Heal Spirit",
      "Ice Golem","Ice Spirit","Ice Wizard","Inferno Dragon","Knight","Lava Hound","Lava Pup","Little Prince","Lumberjack",
      "Magic Archer","Mega Knight","Mega Minion","Mighty Miner","Miner","Mini P.E.K.K.A.","Minion Horde","Minions",
      "Monk","Mother Witch","Monster","Musketeer","Night Witch","P.E.K.K.A.","Phoenix","Prince","Princess","Ram Rider",
      "Rascal Boy","Rascal Girl","Royal Ghost","Royal Giant","Royal Hogs","Royal Recruits","Rune Giant","Skeleton Army",
      "Skeleton Barrel","Skeleton Dragons","Skeleton King","Skeletons","Sparky","Spear Goblins","Spirit Empress",
      "Suspicious Bush","Three Musketeers","Valkyrie","Wall Breakers","Witch","Wizard","Zappies"
    ],
    
    buildings: ["Bomb Tower","Cannon","Inferno Tower","Mortar","Tesla","X-Bow","Barbarian Hut","Elixir Collector",
      "Goblin Cage","Goblin Drill","Goblin Hut","Tombstone"
    ],
    
    spells: ["Arrows","Barbarian Barrel","Earthquake","Fireball","Freeze","Giant Snowball","Goblin Curse","Lightning",
      "Poison","Rage","Rocket","Royal Delivery","The Log","Tornado","Vines","Void","Zap"
    ]
  },
  
  "Physics": {
    kinematics: [
      "Displacement","Velocity","Acceleration","Free Fall","Projectile Motion","Kinematic Equations","Constant Acceleration",
      "Position-Time Graph","Velocity-Time Graph"
    ],

    forces: [
      "Newton's First Law","Newton's Second Law","Newton's Third Law","Force","Mass","Weight","Friction","Normal Force",
      "Tension","Net Force","Inertia","Equilibrium","Free Body Diagram","Air Resistance", "F=ma"
    ],

    energy: [
      "Kinetic Energy","Potential Energy","Conservation of Energy","Work","Power","Mechanical Energy","Thermal Energy",
      "Energy Transfer","Work-Energy Theorem","Efficiency","Gravitational Energy","Spring Energy","Elastic Energy",
      "Hooke's Law","Simple Machines","Energy Loss"
    ],

    momentum: [
      "Linear Momentum","Impulse","Conservation of Momentum","Elastic Collision","Inelastic Collision","Center of Mass",
      "Momentum Transfer","Recoil","Explosion","Momentum Vector","Elastic Bounce","Inelastic Bounce","Perfectly Inelastic",
      "Angular Momentum"
    ],

    circular: [
      "Centripetal Force","Centripetal Acceleration","mv^2/r", "v^2/r"
    ],

    fluids: [
      "Density","Pressure","Buoyancy","Archimedes' Principle","Bernoulli's Principle","Continuity Equation","Fluid Flow",
      "Laminar Flow","Viscosity","Hydraulic Lift","Pascal's Law","Hydrostatic Pressure","Streamlines","Flow Rate","Turbulent Flow"
    ],

    rotation: [
      "Angular Acceleration","Angular Momentum","Inertia","Center of Mass", "Rotational Kinetic Energy", "Rotational Kinematics"
    ],

    shm: [
      "Periodic Motion","Frequency","Amplitude","Phase","Restoring Force","Spring Oscillation","Pendulum Oscillation","Resonance"
    ],

    thermo: [
      "Temperature","Heat Transfer","Conduction","Convection","Radiation","Internal Energy","Specific Heat",
      "Thermal Equilibrium"
    ],

    electricity: [
      "Charge","Electric Field","Voltage","Current","Resistance","Ohm's Law","Power","Series Circuit",
      "Parallel Circuit","Circuit Diagram"
    ],

    gravity: [
      "Gravitational Constant","Gravitational Force","mg","Kepler's 3rd law"
    ]
  },
  
  "Math": {
    algebra: [
      "Variable","Expression","Equation","Inequality","Linear Equation",
      "Quadratic Equation","Polynomial","Factoring","Completing the Square",
      "Exponential Function","Logarithmic Function","Rational Expression",
      "System of Equations","Matrix","Vector","Function","Domain","Range"
    ],

    geometry: [
      "Point","Line","Plane","Angle","Congruent","Similarity","Triangle",
      "Pythagorean Theorem","Circle","Radius","Diameter","Chord","Arc",
      "Central Angle","Inscribed Angle","Area","Perimeter","Volume","Surface Area"
    ],

    trigonometry: [
      "Sine","Cosine","Tangent","Unit Circle","Radians","Degrees",
      "Pythagorean Identity","Law of Sines","Law of Cosines","Trigonometric Graphs",
      "Amplitude","Period","Phase Shift","Inverse Trig Function"
    ],

    precalculus: [
      "Sequence","Series","Arithmetic Sequence","Geometric Sequence",
      "Binomial Theorem","Polynomial Division","Rational Function",
      "Asymptote","Complex Number","Imaginary Unit"
    ],

    statistics: [
      "Mean","Median","Mode","Range","Standard Deviation","Variance",
      "Probability","Combination","Permutation","Normal Distribution",
      "Outlier","Correlation"
    ]
  },

  "Calculus": {
    limits: [
      "Limit","Continuity","One-Sided Limit","Infinite Limit","Limit Laws","Indeterminate Form",
      "Removable Discontinuity","Jump Discontinuity","Vertical Asymptote","Horizontal Asymptote",
      "Squeeze Theorem","L'HÃ´pital's Rule"
    ],

    derivatives: [
      "Derivative","Differentiability","Tangent Line","Instantaneous Rate","Power Rule","Sum Rule","Difference Rule",
      "Product Rule","Quotient Rule","Chain Rule","Implicit Differentiation","Higher Derivative","Second Derivative",
      "Third Derivative","Inverse Function","Logarithmic Differentiation","Exponential Derivative","Trig Derivative"
    ],

    applicationsOfDerivatives: [
      "Critical Point","Local Maximum","Local Minimum","First Derivative Test","Second Derivative Test",
      "Inflection Point","Concave Up","Concave Down","Optimization","Related Rates",
      "Velocity Function","Acceleration Function","Motion on a Line","Mean Value Theorem"
    ],

    integrals: [
      "Antiderivative","Indefinite Integral","Definite Integral","Constant of Integration","Net Change",
      "Area Under Curve","Riemann Sum","Trapezoidal Rule","Accumulation Function","Average Value",
      "U-Substitution"
    ],

    applicationsOfIntegrals: [
      "Differential Equation","Separation of Variables","Initial Condition","Rate of Change",
      "Motion with Acceleration","Distance and Displacement","Growth and Decay"
    ],

    theorems: [
      "Fundamental Theorem of Calculus","Mean Value Theorem","Rolle's Theorem"
    ]
  },
  
  "Computer Science": {
    programmingBasics: [
      "Variable","Constant","Data Type","Integer","Float","Boolean","String",
      "Expression","Statement","Comment","Indentation"
    ],

    basicCommands: [
      "If Statement","Else Statement","Else If","Comparison Operator","Logical Operator",
      "For Loop","While Loop","Break","Continue","Iteration","Recursion"
    ],

    functions: [
      "Function","Parameter","Argument","Return Value","Scope","Local Variable",
      "Global Variable","Function Call","Function Definition"
    ],

    dataStructures: [
      "Array","List","Tuple","Dictionary","Object","Stack","Queue","Set",
      "Linked List","Tree","Binary Tree","Graph","Hash Table","Pointer","Node"
    ],

    algorithms: [
      "Searching","Linear Search","Binary Search","Sorting","Bubble Sort",
      "Selection Sort","Insertion Sort","Merge Sort","Quick Sort",
      "Time Complexity","Space Complexity","Big O Notation","Recursion","Divide and Conquer"
    ],

    ai: [
      "Machine Learning","Neural Network","Training","Testing","Dataset",
      "Supervised Learning","Unsupervised Learning","Classification",
      "Regression","Accuracy","Precision","Recall","Overfitting","Underfitting"
    ],
    
    languages: [
      "Python","Java","JavaScript","C","C++","C#","Scratch","SQL","HTML","CSS"
    ]
  },

  "Animals": {
    mammals: ["Lion","Elephant","Dolphin","Kangaroo","Panda","Giraffe","Tiger","Wolf","Bear","Monkey"],
    birds: ["Eagle","Penguin","Peacock","Owl","Hummingbird","Parrot","Flamingo","Swan","Woodpecker","Kingfisher"],
    reptiles: ["Crocodile","Komodo Dragon","Chameleon","Iguana","Gecko","Turtle","Snake","Alligator","Monitor Lizard","Tortoise"],
    aquatic: ["Shark","Octopus","Jellyfish","Starfish","Seahorse","Whale","Dolphin","Squid","Crab","Lobster"],
    insects: ["Butterfly","Dragonfly","Ladybug","Ant","Bee","Spider","Beetle","Grasshopper","Mantis","Firefly"]
  },
  
  "Fruits": {
    citrus: ["Orange","Lemon","Lime","Grapefruit","Tangerine","Clementine","Kumquat","Pomelo","Yuzu","Ugli Fruit"],
    tropical: ["Mango","Pineapple","Coconut","Papaya","Dragon Fruit","Passion Fruit","Guava","Lychee","Rambutan","Durian"],
    berries: ["Strawberry","Blueberry","Raspberry","Blackberry","Cranberry","Gooseberry","Elderberry","Boysenberry","Mulberry","Acai Berry"],
    stone: ["Peach","Plum","Cherry","Apricot","Nectarine","Mango","Lychee","Date","Olive","Coconut"],
    melons: ["Watermelon","Cantaloupe","Honeydew","Galia","Canary","Santa Claus","Crenshaw","Sharlyn","Casaba","Sprite"]
  },
  
  "Countries": {
    europe: ["France","Germany","Italy","Spain","United Kingdom","Greece","Netherlands","Sweden","Switzerland","Norway"],
    asia: ["Japan","China","India","South Korea","Thailand","Vietnam","Indonesia","Philippines","Malaysia","Singapore"],
    americas: ["United States","Canada","Brazil","Mexico","Argentina","Chile","Peru","Colombia","Cuba","Jamaica"],
    africa: ["Egypt","South Africa","Kenya","Morocco","Nigeria","Ghana","Tanzania","Ethiopia","Uganda","Rwanda"],
    oceania: ["Australia","New Zealand","Fiji","Papua New Guinea","Samoa","Tonga","Vanuatu","Solomon Islands","Kiribati","Micronesia"]
  },
  
  "Sports": {
    ball: ["Basketball","Soccer","Football","Baseball","Tennis","Volleyball","Golf","Rugby","Cricket","Handball"],
    water: ["Swimming","Surfing","Water Polo","Diving","Rowing","Sailing","Canoeing","Kayaking","Water Skiing","Synchronized Swimming"],
    winter: ["Skiing","Snowboarding","Ice Hockey","Figure Skating","Bobsleigh","Curling","Biathlon","Luge","Speed Skating","Freestyle Skiing"],
    combat: ["Boxing","Wrestling","Martial Arts","Fencing","Judo","Taekwondo","Karate","MMA","Kendo","Sumo"],
    individual: ["Gymnastics","Athletics","Cycling","Archery","Weightlifting","Triathlon","Equestrian","Shooting","Badminton","Table Tennis"]
  },
  
   "Names": {
    name: ["Leon","Matteo","Illay","Carver","Ethan","Naoki","Thomas","Sean","Luke", "Nico"]
  },
  
  "Minecraft": {
  
  mobs: [
    "Villager","Cow","Pig","Chicken","Sheep","Wolf","Horse","Cat","Fox","Bee","Rabbit","Parrot","Llama",
    "Zombie","Skeleton","Creeper","Spider","Enderman","Slime","Witch","Phantom","Pillager","Blaze","Ghast",
    "Piglin","Hoglin","Guardian","Evoker","Vex","Warden","Ender Dragon","Wither"
  ],

  blocks: [
    "Stone","Dirt","Sand","Gravel","Wood","Leaves","Glass","Obsidian","Clay","Bricks","Netherrack","End Stone",
    "Basalt","Deepslate","Bedrock"
  ],

  resources: [
    "Coal","Iron","Gold","Diamond","Emerald","Redstone","Lapis","Copper","Nether Quartz","Ancient Debris"
  ],

  items: [
    "Sword","Axe","Pickaxe","Shovel","Bow","Shield","Trident","Fishing Rod","Compss","Clock","Shears","Map"
  ],

  food: [
    "Bread","Steak","Cooked Porkchop","Cooked Chicken","Baked Potato","Carrot","Apple","Melon","Chorus Fruit",
    "Golden Apple","Pumpkin Pie","Honey Bottle"
  ],

  structures: [
    "Village","Temple","Stronghold","Mineshaft","Ocean Monument","Ruined Portal","Nether Fortress","Bastion",
    "End City","Ancient City"
  ],

  biomes: [
    "Plains","Forest","Taiga","Jungle","Desert","Savanna","Swamp","Mountains","Snowy Biome","Ocean","Badlands",
    "Mushroom Biome","Nether","End"
  ],

  toolsAndGear: [
    "Pickaxe","Sword","Axe","Hoe","Shovel","Armor","Helmet","Chestplate","Leggings","Boots","Shield","Crossbow"
  ],

  magicAndPotions: [
    "Enchanting Table","Potion of Healing","Potion of Strength","Potion of Swiftness","Potion of Fire Resistance",
    "Potion of Regeneration","Potion of Invisibility","Potion of Slow Falling"
  ]
},

"Geometry Dash": {
  levels: [
    "Stereo Madness","Back on Track","Polargeist","Dry Out","Base After Base","Can't Let Go","Jumper",
    "Time Machine","Cycles","xStep","Clutterfunk","Theory of Everything","Electroman Adventures",
    "Geometrical Dominator","Hexagon Force","Blast Processing","Electrodynamix","Clubstep","Theory of Everything 2",
    "Deadlocked","ORBIT","LIMBO","Bloodbath","Top 10","Bloodshower","Purpular Rectanglisi (mer green)","Sonic Wave",
    "Change of Scene","Absolute Garbage","HOW","WHAT","Grass","Nagatabi","Sunrise","Night City"
  ],

  gamemodes: [
    "Cube","Robot","Ship","Ball","Wave","Spider","UFO","Swing Copter"
  ],

  structures: [
    "Ekirby8 Tower","Clubstep Monster","Triple Spike"
  ]
},

"Objects": {
  objects: [
    "Chair","Table","Sofa","Bed","Lamp","Mirror","Clock","Pillow","Blanket",
    "Curtain","Candle","TV","Remote","Shelf","Plate","Cup","Fork","Knife",
    "Spoon","Pan","Pot","Bottle","Microwave","Fridge","Toaster","Phone",
    "Laptop","Tablet","Headphones","Charger","Mouse","Keyboard","Camera",
    "Smartwatch","Speaker","Notebook","Pencil","Pen","Eraser","Ruler",
    "Backpack","Calculator","Binder","Shirt","Pants","Jacket","Hat","Socks",
    "Shoes","Gloves","Belt","Hammer","Screwdriver","Wrench","Pliers","Drill",
    "Saw","Tape Measure","Car","Bike","Bus","Train","Scooter","Motorcycle",
    "Airplane","Boat","Wallet","Keys","Water Bottle","Backpack","Trash Can",
    "Umbrella","Broom","Mop","Vacuum","Toothbrush","Toothpaste","Soap",
    "Shampoo","Comb","Hairdryer","Sunglasses","Watch","Notebook","Stapler",
    "Paperclip","Highlighter","Glue","Scissors"
  ]
},

"Environmental Science": {

  ecology: [
    "Ecosystem","Biome","Habitat","Niche","Biodiversity","Species Richness","Species Evenness","Keystone Species",
    "Indicator Species","Invasive Species","Native Species","Endangered Species","Extinction","Speciation",
    
    "Population Growth","Carrying Capacity","Limiting Factor","Density-Dependent Factor","Density-Independent Factor",
    "r-Selected Species","K-Selected Species","Survivorship Curve","Population Dynamics","Growth Rate","Logistic Growth",
    
    "Producer","Consumer","Herbivore","Carnivore","Omnivore","Detritivore","Decomposer","Trophic Level","Food Web",
    "Primary Productivity","Gross Primary Productivity","Net Primary Productivity"
  ],

  cycles: [
    "Biogeochemical Cycle","Water Cycle","Carbon Cycle","Nitrogen Cycle","Phosphorus Cycle","Sulfur Cycle",
    "Evaporation","Condensation","Precipitation","Transpiration","Nitrogen Fixation","Assimilation","Respiration"
  ],

  atmosphereClimate: [
    "Climate","Weather","Albedo","Greenhouse Effect","Global Warming","Climate Change","Deforestation",
    "Desertification","Ocean Acidification","Glacier Retreat","Sea Level Rise","Carbon Sequestration",
    
    "Atmosphere","Troposphere","Stratosphere","Ozone Layer","Greenhouse Gas","CO2","Methane","Nitrous Oxide"
  ],

  earthSystems: [
    "Soil","Soil Formation","Soil Horizon","Erosion","Deposition","Humus","Sand","Silt","Clay","Soil Texture",
    
    "Plate Tectonics","Convergent Boundary","Divergent Boundary","Transform Boundary","Earthquake","Volcano","Subduction",
    
    "Tragedy of the Commons","Maximum Sustainable Yield","Resource Management","Sustainability","Ecological Footprint",
    "Conservation","Preservation","Restoration","Recycling","Composting"
  ],

  humanImpact: [
    "Air Pollution","Water Pollution","Noise Pollution","Light Pollution","Smog","Acid Rain","Eutrophication",
    "Biomagnification","Bioaccumulation","Turbidity","pH","Dissolved Oxygen",
    
    "Agriculture","Industrial Agriculture","Monoculture","Crop Rotation","Irrigation","Soil Degradation",
    "Pesticide","Fertilizer","Herbicide","Pesticide Resistance","Integrated Pest Management",
    
    "Mining","Overfishing","Bycatch","Habitat Fragmentation","Edge Effect","Urban Sprawl",
    
    "Fossil Fuel","Renewable Energy"
  ]
},

"Robotics": {

  mechanics: [
    "servo","motor","claw","battery","wombat","botball","light sensor","touch sensor","Vishwa","3D modeling", "gears", "wheels",
	"gear ratio", "torque", "port#"
  ],

	coding:[
		"python", "for loop", "while loop", "print", "line follow", "function", "if statement", "kipr libary","set_servo_position()","motor(x)","msleep(t)","Pseudocode",
		"variable", "boolean", "debug"
	]
},

"AP Classes": {
  class: [
    "AP Calculus AB",
    "AP Calculus BC",
    "AP Statistics",
    "AP Computer Science A",
    "AP Computer Science Principles",
    "AP Biology",
    "AP Chemistry",
    "AP Physics 1",
    "AP Physics 2",
    "AP Physics C Mechanics",
    "AP Physics C Electricity & Magnetism",
    "AP Environmental Science",
    "AP Human Geography",
    "AP Psychology",
    "AP World History",
    "AP U.S. History",
    "AP European History",
    "AP Government & Politics",
    "AP Macroeconomics",
    "AP Microeconomics",
    "AP Spanish",
    "AP French",
    "AP Chinese",
    "AP Latin",
    "AP English Language",
    "AP English Literature",
    "AP Art History",
    "AP Music Theory",
    "AP Studio Art"
  ],
},

"School Food": {

  lunch: [
    "Pizza","Chicken Waffles","Salad","Pasta","Burrito","Quesadilla","Rice Bowl","Grilled Cheese","Hamburger"
  ],
  
  sides: [
	"Apple Sauce","Craisins", "Milk", "Carrots"
  ],
  
  brunch: [
	"Granola Bar", "Yogurt", "Pancake", "Muffin", "Burrito", "Bagel"
  ]
},

"Questions": {
  question: [
    "Most likely to become rich",
    "Most likely to become famous",
    "Most likely to start a business",
    "Most likely to win a Nobel Prize",
    "Most likely to drop out of school",
    "Most likely to go to jail",
    "Most likely to become a comedian",
    "Most likely to become a teacher",
    "Most likely to travel the world",
    "Most likely to live alone forever",
    "Most likely to have 10 pets",
    "Most likely to win the lottery",
    "Most likely to become a millionaire before 30",
    "Most likely to start a YouTube channel",
    "Most likely to become a pro athlete",
    "Most likely to become a doctor",
    "Most likely to become president",
    "Most likely to join the military",
    "Most likely to become a lawyer",
    "Most likely to date a celebrity",
    "Most likely to forget their own birthday",
    "Most likely to forget where they live",
    "Most likely to cry during a movie",
    "Most likely to start a fight",
    "Most likely to fall asleep in class",
    "Most likely to get lost in their own neighborhood",
    "Most likely to laugh at their own joke",
    "Most likely to survive a zombie apocalypse",
    "Most likely to die first in a horror movie",
    "Most likely to crash their car",
    "Most likely to be late to their own wedding",
    "Most likely to have 10 kids",
    "Most likely to become a billionaire",
    "Most likely to donate millions to charity",
    "Most likely to go skydiving",
    "Most likely to get a weird tattoo",
    "Most likely to eat something off the floor",
    "Most likely to forget their homework",
    "Most likely to get expelled",
    "Most likely to get the highest GPA",
    "Most likely to be class clown",
    "Most likely to skip school",
    "Most likely to live in another country",
    "Most likely to become a model",
    "Most likely to become an influencer",
    "Most likely to invent something",
    "Most likely to win a game show",
    "Most likely to run a marathon",
    "Most likely to become a scientist",
    "Most likely to go bald early",
    "Most likely to get plastic surgery",
    "Most likely to own a yacht",
    "Most likely to own a private jet",
    "Most likely to own a mansion",
    "Most likely to go bankrupt",
    "Most likely to disappear and never return",
	"Most likely to be the teacher's pet",
  ]
}

};

/* ===== LOCAL STORAGE LOAD ===== */
playerCountInput.value = localStorage.getItem("playerCount") || 3;
imposterCountInput.value = localStorage.getItem("imposterCount") || 1;
currentSubject = localStorage.getItem("currentSubject") || "";
actualCustomSubject = localStorage.getItem("actualCustomSubject") || "";
customItems = JSON.parse(localStorage.getItem("customItems")) || [];
detectiveToggle.checked = JSON.parse(localStorage.getItem("detectiveEnabled")) || false;
jesterToggle.checked = JSON.parse(localStorage.getItem("jesterEnabled")) || false;
assassinToggle.checked = JSON.parse(localStorage.getItem("assassinEnabled")) || false;

// DON'T load player names from localStorage - always reset to default on page load
// This ensures names reset to Player 1, Player 2, etc. when page reloads
playerNames = []; // Start with empty array

/* ===== MODAL FUNCTIONS ===== */
function openModal() {
  modalOverlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modalOverlay.classList.remove('active');
  document.body.style.overflow = 'auto';
}

// Modal event listeners
infoBtn.addEventListener('click', openModal);
closeModalBtn.addEventListener('click', closeModal);

// Close modal when clicking outside
modalOverlay.addEventListener('click', (e) => {
  if (e.target === modalOverlay) {
    closeModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
    closeModal();
  }
});

/* ===== INITIALIZE SUBJECT OPTIONS ===== */
function initializeSubjectOptions() {
  subjectOptions.innerHTML = "";
  
  // Get all subject names and sort them alphabetically
  const sortedSubjectNames = Object.keys(defaultSubjects).sort();
  
  sortedSubjectNames.forEach(subject => {
    const option = document.createElement("div");
    option.className = "subject-option";
    option.textContent = subject;
    option.dataset.subject = subject;
    
    if (subject === currentSubject) {
      option.classList.add("selected");
    }
    
    option.addEventListener("click", () => selectSubject(subject));
    subjectOptions.appendChild(option);
  });
}

/* ===== SUBJECT MANAGEMENT ===== */
function selectSubject(subject) {
  // Remove selected class from all options
  document.querySelectorAll('.subject-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  
  // Add selected class to clicked option
  const selectedOption = document.querySelector(`[data-subject="${subject}"]`);
  if (selectedOption) {
    selectedOption.classList.add('selected');
  }
  
  currentSubject = subject;
  actualCustomSubject = ""; // Clear custom subject when selecting a default one
  
  // For default subjects, combine all items from all categories
  customItems = [];
  Object.values(defaultSubjects[subject]).forEach(categoryItems => {
    customItems.push(...categoryItems);
  });
  
  localStorage.setItem("currentSubject", currentSubject);
  localStorage.setItem("actualCustomSubject", actualCustomSubject);
  localStorage.setItem("customItems", JSON.stringify(customItems));
  
  showSelectedSubject();
  enableGenerateButton();
  errorBox.textContent = "";
  
  // Clear custom input
  customSubjectInput.value = "";
}

function useCustomSubject() {
  const subject = customSubjectInput.value.trim();
  if (!subject) {
    errorBox.textContent = "Please enter a custom subject";
    return;
  }
  
  // Remove selected class from all options
  document.querySelectorAll('.subject-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  
  // Store the actual custom word privately
  actualCustomSubject = subject;
  // Display "Custom" to users so they can't see what was entered
  currentSubject = "Custom";
  
  // Use only the exact word/phrase entered - no modifications
  customItems = [actualCustomSubject];
  
  localStorage.setItem("currentSubject", currentSubject);
  localStorage.setItem("actualCustomSubject", actualCustomSubject);
  localStorage.setItem("customItems", JSON.stringify(customItems));
  
  showSelectedSubject();
  enableGenerateButton();
  errorBox.textContent = "";
  
  // Clear input
  customSubjectInput.value = "";
}

function showSelectedSubject() {
  selectedSubjectName.textContent = currentSubject;
  subjectDisplay.style.display = 'block';
  subjectSelection.style.display = 'none';
}

function changeSubject() {
  subjectDisplay.style.display = 'none';
  subjectSelection.style.display = 'block';
  generateBtn.disabled = true;
  generateBtn.textContent = "Select Subject First";
  
  // Clear any existing cards
  cardsContainer.innerHTML = "";
  revealTracker.textContent = "";
  firstPlayerBox.classList.remove('show');
  firstPlayerBox.textContent = '';
  revealRolesBtn.style.display = 'none';
  rolesRevealBox.classList.remove('show');
  rolesRevealBox.innerHTML = '';
}

function enableGenerateButton() {
  generateBtn.disabled = false;
  generateBtn.textContent = "Deal Cards";
}

/* ===== PLAYER NAMES MANAGEMENT ===== */
function updatePlayerNamesList() {
  const playerCount = parseInt(playerCountInput.value, 10);
  playerNamesList.innerHTML = "";
  
  // Ensure playerNames array has the right length with default names
  while (playerNames.length < playerCount) {
    playerNames.push(`Player ${playerNames.length + 1}`);
  }
  
  // Trim if too long
  playerNames = playerNames.slice(0, playerCount);
  
  // Save to localStorage
  localStorage.setItem("playerNames", JSON.stringify(playerNames));
  
  // Create input for each player
  for (let i = 0; i < playerCount; i++) {
    const container = document.createElement("div");
    container.className = "player-name-input-container";
    
    const label = document.createElement("div");
    label.className = "player-name-label";
    label.textContent = `Player ${i + 1}`;
    
    const input = document.createElement("input");
    input.className = "player-name-input";
    input.type = "text";
    input.value = playerNames[i] || `Player ${i + 1}`;
    input.placeholder = `Player ${i + 1}`;
    input.dataset.index = i;
    
    // Update player name when input changes
    input.addEventListener("input", (e) => {
      const index = parseInt(e.target.dataset.index);
      playerNames[index] = e.target.value.trim() || `Player ${index + 1}`;
      localStorage.setItem("playerNames", JSON.stringify(playerNames));
    });
    
    container.appendChild(label);
    container.appendChild(input);
    playerNamesList.appendChild(container);
  }
}

function randomizePlayerNames() {
  const namePool = [
    "Alex", "Jordan", "Taylor", "Casey", "Riley", "Morgan", "Quinn", "Avery", "Blake", "Cameron",
    "Dakota", "Drew", "Emerson", "Finley", "Harley", "Hayden", "Hunter", "Jamie", "Kai", "Logan",
    "Marley", "Micah", "Parker", "Peyton", "Reese", "River", "Rowan", "Sage", "Skyler", "Spencer",
    "Charlie", "Sam", "Ash", "Lee", "Jesse", "Robin", "Dylan", "Jordan", "Morgan", "Casey",
    "Ariel", "Bailey", "Cameron", "Dakota", "Emerson", "Finley", "Harley", "Hayden", "Hunter", "Jamie",
    "Kai", "Logan", "Marley", "Micah", "Parker", "Peyton", "Reese", "River", "Rowan", "Sage"
  ];
  
  const playerCount = parseInt(playerCountInput.value, 10);
  const usedNames = new Set();
  
  // Reset playerNames array
  playerNames = [];
  
  for (let i = 0; i < playerCount; i++) {
    let name;
    let attempts = 0;
    
    // Try to find a unique name
    do {
      name = namePool[Math.floor(Math.random() * namePool.length)];
      attempts++;
      
      // If we've tried too many times, add a number to make it unique
      if (attempts > 20) {
        name = `${name} ${Math.floor(Math.random() * 100) + 1}`;
        break;
      }
    } while (usedNames.has(name));
    
    usedNames.add(name);
    playerNames.push(name);
  }
  
  // Save to localStorage and update UI
  localStorage.setItem("playerNames", JSON.stringify(playerNames));
  updatePlayerNamesList();
}

function resetPlayerNames() {
  const playerCount = parseInt(playerCountInput.value, 10);
  
  // Reset to Player 1, Player 2, etc.
  playerNames = [];
  for (let i = 0; i < playerCount; i++) {
    playerNames.push(`Player ${i + 1}`);
  }
  
  // Save to localStorage and update UI
  localStorage.setItem("playerNames", JSON.stringify(playerNames));
  updatePlayerNamesList();
}

function showPlayerNames() {
  playerNamesSection.style.display = 'block';
  showPlayerNamesBtn.style.display = 'none';
  updatePlayerNamesList();
}

function hidePlayerNames() {
  playerNamesSection.style.display = 'none';
  showPlayerNamesBtn.style.display = 'block';
}

/* ===== UPDATE TRACKER ===== */
function updateTracker() {
  if (totalCards === 0) {
    revealTracker.textContent = "";
    return;
  }
  
  revealTracker.textContent = `Revealed: ${revealedCards} / ${totalCards} cards`;
  
  if (lockedCards === totalCards && totalCards > 0) {
    selectFirstPlayer();
  }
}

/* ===== SELECT FIRST PLAYER ===== */
function selectFirstPlayer() {
  const randomPlayer = Math.floor(Math.random() * totalCards) + 1;
  
  setTimeout(() => {
    // Use custom player name if available
    const playerName = playerNames[randomPlayer - 1] || `Player ${randomPlayer}`;
    let firstPlayerText = `${playerName} goes first!`;
    
    // Add role status
    const roleNotes = [];
    if (detectiveToggle.checked) {
      roleNotes.push("Detective");
    }
    if (jesterToggle.checked) {
      roleNotes.push("Jester");
    }
    if (assassinToggle.checked) {
      roleNotes.push("Assassin");
    }
    
    if (roleNotes.length > 0) {
      firstPlayerText += `\n(${roleNotes.join(" & ")} in play)`;
    }
    
    firstPlayerBox.textContent = firstPlayerText;
    firstPlayerBox.classList.add('show');
    revealRolesBtn.style.display = 'block';
    firstPlayerBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 500);
}

/* ===== REVEAL ALL ROLES ===== */
function revealAllRoles() {
  const roleList = document.createElement('div');
  roleList.className = 'roles-reveal-content';
  
  const header = document.createElement('div');
  header.className = 'roles-reveal-header';
  header.innerHTML = '<h3>All Roles Revealed</h3>';
  
  const listContainer = document.createElement('ul');
  listContainer.className = 'role-list';
  
  words.forEach((word, i) => {
    const playerNumber = i + 1;
    const playerName = playerNames[i] || `Player ${playerNumber}`;
    
    let roleName = "";
    let roleClass = "";
    let specialNote = "";
    
    if (word === secretItem) {
      roleName = "Civilian";
      roleClass = "civilian-role";
    } else if (word === "Imposter") {
      roleName = "Imposter";
      roleClass = "imposter-role";
    } else if (word === "Detective") {
      roleName = "Detective";
      roleClass = "detective-role";
    } else if (word === "Jester") {
      roleName = "Jester";
      roleClass = "jester-role";
    } else if (word === "Assassin") {
      roleName = "Assassin";
      roleClass = "assassin-role";
      if (assassinTarget) {
        const targetName = playerNames[assassinTarget - 1] || `Player ${assassinTarget}`;
        specialNote = `<div class="assassin-target">Target: ${targetName}</div>`;
      }
    }
    
    const li = document.createElement('li');
    li.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <span class="player-number">${playerName}</span>
        <div style="flex: 1; display: flex; flex-direction: column; align-items: flex-end;">
          <span class="role-name ${roleClass}">${roleName}</span>
          ${specialNote}
        </div>
      </div>
    `;
    
    listContainer.appendChild(li);
  });
  
  roleList.appendChild(header);
  roleList.appendChild(listContainer);
  
  rolesRevealBox.innerHTML = '';
  rolesRevealBox.appendChild(roleList);
  rolesRevealBox.classList.add('show');
  revealRolesBtn.style.display = 'none';
  rolesRevealBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

/* ===== HELPER FUNCTIONS ===== */
function getRandomItemFromArray(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

/* ===== MAIN GAME FUNCTION ===== */
function generateCards() {
  if (!currentSubject || customItems.length === 0) {
    errorBox.textContent = "Please select a subject first";
    return;
  }
  
  // Reset state
  revealedCards = 0;
  lockedCards = 0;
  playerNumbers = [];
  firstPlayerBox.classList.remove('show');
  firstPlayerBox.textContent = '';
  revealRolesBtn.style.display = 'none';
  rolesRevealBox.classList.remove('show');
  rolesRevealBox.innerHTML = '';
  errorBox.textContent = "";

  const playerCount = parseInt(playerCountInput.value, 10);
  const imposterCount = parseInt(imposterCountInput.value, 10);

  if (playerCount < 3) {
    errorBox.textContent = "There must be at least 3 players.";
    return;
  }

  if (imposterCount < 1) {
    errorBox.textContent = "At least 1 imposter.";
    return;
  }

  if (imposterCount >= playerCount) {
    errorBox.textContent = "Imposters must be less than total players.";
    return;
  }

  // Check if we have enough non-imposter slots for special roles
  const civilianSlots = playerCount - imposterCount;
  let specialRolesCount = 0;
  if (detectiveToggle.checked) specialRolesCount++;
  if (jesterToggle.checked) specialRolesCount++;
  if (assassinToggle.checked) specialRolesCount++;
  
  if (civilianSlots < specialRolesCount + 1) { // +1 for at least one regular civilian
    errorBox.textContent = `Need at least ${specialRolesCount + 1} non-imposters for special roles. Reduce imposters or players.`;
    return;
  }

  // Save settings
  localStorage.setItem("playerCount", playerCount);
  localStorage.setItem("imposterCount", imposterCount);

  // Select random item from all available items
  secretItem = getRandomItemFromArray(customItems);
  
  // Determine category based on whether it's a default subject
  secretCategory = "Common";
  if (defaultSubjects[currentSubject]) {
    // Find which category the item belongs to
    for (const [category, items] of Object.entries(defaultSubjects[currentSubject])) {
      if (items.includes(secretItem)) {
        secretCategory = category;
        break;
      }
    }
  } else {
    // For custom subjects, just use "Custom" as the category
    secretCategory = "Custom";
  }

  // Initialize words array with all civilians
  words = Array(playerCount).fill("Civilian");

  // Assign imposters first
  let imposters = 0;
  while (imposters < imposterCount) {
    const idx = Math.floor(Math.random() * playerCount);
    if (words[idx] === "Civilian") {
      words[idx] = "Imposter";
      imposters++;
    }
  }

  // Assign detective (optional) - replaces a civilian
  let detectiveIndex = null;
  if (detectiveToggle.checked) {
    let assigned = false;
    while (!assigned) {
      const idx = Math.floor(Math.random() * playerCount);
      if (words[idx] === "Civilian") {
        words[idx] = "Detective";
        detectiveIndex = idx;
        assigned = true;
      }
    }
  }

  // Assign jester (optional) - replaces a civilian
  let jesterIndex = null;
  if (jesterToggle.checked) {
    let assigned = false;
    while (!assigned) {
      const idx = Math.floor(Math.random() * playerCount);
      if (words[idx] === "Civilian") {
        words[idx] = "Jester";
        jesterIndex = idx;
        assigned = true;
      }
    }
  }

  // Assign assassin (optional) - replaces a civilian
  let assassinIndex = null;
  assassinTarget = null;
  if (assassinToggle.checked) {
    let assigned = false;
    while (!assigned) {
      const idx = Math.floor(Math.random() * playerCount);
      if (words[idx] === "Civilian") {
        words[idx] = "Assassin";
        assassinIndex = idx;
        
        // Choose a target for the assassin (not themselves, not an imposter)
        // Create list of possible targets
        const possibleTargets = [];
        for (let i = 0; i < playerCount; i++) {
          if (i !== idx && words[i] !== "Imposter") {
            possibleTargets.push(i);
          }
        }
        
        // Check if there are any valid targets
        if (possibleTargets.length > 0) {
          const targetIdx = possibleTargets[Math.floor(Math.random() * possibleTargets.length)];
          assassinTarget = targetIdx + 1; // Store as player number (1-based)
          assigned = true;
        } else {
          // If no valid targets, try a different assassin
          words[idx] = "Civilian"; // Reset and try again
        }
      }
    }
  }

  // Replace all non-imposter, non-detective, non-jester, non-assassin with the secret item
  for (let i = 0; i < words.length; i++) {
    if (words[i] === "Civilian") {
      words[i] = secretItem;
    }
  }

  // Track which player is which role before shuffling
  const rolesBeforeShuffle = [...words];
  
  // Create a mapping of original positions to shuffled positions
  const indices = Array.from({length: playerCount}, (_, i) => i);
  
  // Shuffle indices
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  
  // Apply the same shuffle to words
  const shuffledWords = indices.map(i => words[i]);
  words = shuffledWords;
  
  // Now we need to update the assassin's target based on the shuffle
  if (assassinToggle.checked && assassinIndex !== null && assassinTarget !== null) {
    // Find where the assassin ended up after shuffle
    let newAssassinIndex = null;
    for (let i = 0; i < indices.length; i++) {
      if (indices[i] === assassinIndex) {
        newAssassinIndex = i;
        break;
      }
    }
    
    // Find where the target ended up after shuffle
    let newTargetIndex = null;
    const originalTargetIndex = assassinTarget - 1; // Convert from player number to index
    for (let i = 0; i < indices.length; i++) {
      if (indices[i] === originalTargetIndex) {
        newTargetIndex = i;
        break;
      }
    }
    
    // If the assassin somehow ended up as their own target (shouldn't happen with proper shuffle),
    // we need to fix it by swapping with another non-imposter
    if (newAssassinIndex !== null && newTargetIndex !== null && newAssassinIndex === newTargetIndex) {
      // Find another non-imposter to swap with
      for (let i = 0; i < words.length; i++) {
        if (i !== newAssassinIndex && words[i] !== "Imposter" && words[i] !== "Detective" && words[i] !== "Jester" && words[i] !== "Assassin") {
          // Swap the assassin's position with this player
          [words[newAssassinIndex], words[i]] = [words[i], words[newAssassinIndex]];
          
          // Update the target to the player we swapped with
          assassinTarget = i + 1;
          break;
        }
      }
    } else if (newTargetIndex !== null) {
      // Update the assassin target to the new position
      assassinTarget = newTargetIndex + 1;
    }
  }

  cardsContainer.innerHTML = "";
  totalCards = playerCount;
  updateTracker();

  // Build cards
  words.forEach((word, i) => {
    const playerNumber = i + 1;
    const playerName = playerNames[i] || `Player ${playerNumber}`;
    playerNumbers.push(playerNumber);

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="card-header">
        <span>${playerName}</span>
        <span class="status-label">Hidden</span>
      </div>

      <div class="word-box word-hidden"></div>
      <div class="category-box"></div>

      <button class="card-btn">Reveal</button>
    `;

    const wordBox = card.querySelector(".word-box");
    const categoryBox = card.querySelector(".category-box");
    const btn = card.querySelector(".card-btn");
    const statusLabel = card.querySelector(".status-label");

    let viewed = false;
    let revealed = false;
    let specialHint = null; // Store reference to detective, assassin, or jester hint

    btn.addEventListener("click", () => {
      if (viewed) return;

      // Reveal
      if (btn.textContent === "Reveal") {
        // Show appropriate word based on role
        if (word === "Imposter") {
          wordBox.textContent = "Imposter";
        } else if (word === "Detective") {
          // For detective, show the subject word in black
          wordBox.textContent = secretItem;
          
          // Add "Detective" text underneath in green
          const detectiveText = document.createElement("div");
          detectiveText.className = "detective-role";
          detectiveText.textContent = "Detective";
          wordBox.appendChild(detectiveText);
        } else if (word === "Jester") {
          // For jester, show the subject word in black
          wordBox.textContent = secretItem;
          
          // Add "Jester" text underneath in orange
          const jesterText = document.createElement("div");
          jesterText.className = "jester-role";
          jesterText.textContent = "Jester";
          wordBox.appendChild(jesterText);
        } else if (word === "Assassin") {
          // For assassin, show the subject word in black
          wordBox.textContent = secretItem;
          
          // Add "Assassin" text underneath in purple
          const assassinText = document.createElement("div");
          assassinText.className = "assassin-role";
          assassinText.textContent = "Assassin";
          wordBox.appendChild(assassinText);
        } else {
          wordBox.textContent = word; // This is the secret item
        }
        
        wordBox.classList.add("word-revealed");

        // Everyone sees the category
        categoryBox.textContent = "Category: " + secretCategory;
        categoryBox.classList.add("category-shown");

        // Detective ability: show random player peek hint in separate box
        if (word === "Detective") {
          // Create list of possible players to peek at (everyone except self)
          const possiblePlayers = [];
          for (let j = 0; j < playerCount; j++) {
            if (j !== i) {
              possiblePlayers.push(j);
            }
          }
          
          // If there are any other players, peek at one
          if (possiblePlayers.length > 0) {
            const otherPlayer = possiblePlayers[Math.floor(Math.random() * possiblePlayers.length)];
            const otherWord = words[otherPlayer];
            const otherRole = otherWord === "Imposter" ? "Imposter" : 
                             otherWord === "Detective" ? "Detective" : 
                             otherWord === "Jester" ? "Jester" : 
                             otherWord === "Assassin" ? "Assassin" : 
                             "Non-Imposter";
            const otherPlayerName = playerNames[otherPlayer] || `Player ${otherPlayer + 1}`;

            specialHint = document.createElement("div");
            specialHint.className = "detective-hint";
            specialHint.innerHTML = `<strong>You peeked at ${otherPlayerName}:</strong><br>Their role: ${otherRole}`;

            card.appendChild(specialHint);
            
            // Show the hint with animation
            setTimeout(() => {
              specialHint.classList.add('show');
            }, 10);
          } else {
            // Edge case: only one player
            specialHint = document.createElement("div");
            specialHint.className = "detective-hint";
            specialHint.innerHTML = `<strong>No other players to peek at!</strong>`;
            card.appendChild(specialHint);
            
            setTimeout(() => {
              specialHint.classList.add('show');
            }, 10);
          }
        }

        // Assassin ability: show target player
        if (word === "Assassin" && assassinTarget) {
          const targetName = playerNames[assassinTarget - 1] || `Player ${assassinTarget}`;
          specialHint = document.createElement("div");
          specialHint.className = "assassin-hint";
          specialHint.innerHTML = `<strong>Your Mission:</strong><br>Get ${targetName} voted out!`;

          card.appendChild(specialHint);
          
          // Show the hint with animation
          setTimeout(() => {
            specialHint.classList.add('show');
          }, 10);
        }

        // Jester ability: show mission
        if (word === "Jester") {
          specialHint = document.createElement("div");
          specialHint.className = "jester-hint";
          specialHint.innerHTML = `<strong>Your Mission:</strong><br>Get voted out!`;

          card.appendChild(specialHint);
          
          // Show the hint with animation
          setTimeout(() => {
            specialHint.classList.add('show');
          }, 10);
        }

        btn.textContent = "Close";
        statusLabel.textContent = "Revealed";
        
        // Track reveal
        if (!revealed) {
          revealed = true;
          revealedCards++;
          updateTracker();
        }
        return;
      }

      // Close + lock
      if (btn.textContent === "Close") {
        viewed = true;

        // Hide special hint if it exists
        if (specialHint) {
          specialHint.classList.remove('show');
        }

        wordBox.classList.remove("word-revealed");
        categoryBox.classList.remove("category-shown");

        setTimeout(() => {
          // Remove special hint completely when closing
          if (specialHint && specialHint.parentNode) {
            specialHint.parentNode.removeChild(specialHint);
            specialHint = null;
          }
          
          // Clear the word box content and reset
          while (wordBox.firstChild) {
            wordBox.removeChild(wordBox.firstChild);
          }
          
          wordBox.textContent = "Locked";
          wordBox.className = "word-box word-locked";

          btn.textContent = "Locked";
          btn.classList.add("locked");
          btn.disabled = true;
          statusLabel.textContent = "Locked";
          
          // Track lock
          lockedCards++;
          updateTracker();
        }, 250);
      }
    });

    cardsContainer.appendChild(card);
  });
}

/* ===== EVENT LISTENERS ===== */
customSubjectBtn.addEventListener("click", useCustomSubject);
customSubjectInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    useCustomSubject();
  }
});

changeSubjectBtn.addEventListener("click", changeSubject);
generateBtn.addEventListener("click", generateCards);
revealRolesBtn.addEventListener("click", revealAllRoles);

// Player names event listeners
randomizeNamesBtn.addEventListener("click", randomizePlayerNames);
resetNamesBtn.addEventListener("click", resetPlayerNames);
showPlayerNamesBtn.addEventListener("click", showPlayerNames);
hidePlayerNamesBtn.addEventListener("click", hidePlayerNames);

// Update player names when player count changes
playerCountInput.addEventListener("input", () => {
  // Ensure playerNames array has the right length with default names
  const playerCount = parseInt(playerCountInput.value, 10);
  while (playerNames.length < playerCount) {
    playerNames.push(`Player ${playerNames.length + 1}`);
  }
  playerNames = playerNames.slice(0, playerCount);
  localStorage.setItem("playerNames", JSON.stringify(playerNames));
  
  // Update the player names list if it's visible
  if (playerNamesSection.style.display === 'block') {
    updatePlayerNamesList();
  }
});

// Save toggle states
detectiveToggle.addEventListener("change", () => {
  localStorage.setItem("detectiveEnabled", detectiveToggle.checked);
});

jesterToggle.addEventListener("change", () => {
  localStorage.setItem("jesterEnabled", jesterToggle.checked);
});

assassinToggle.addEventListener("change", () => {
  localStorage.setItem("assassinEnabled", assassinToggle.checked);
});

/* ===== INITIALIZATION ===== */
initializeSubjectOptions();

// Initialize player names array with default values (Player 1, Player 2, etc.)
const playerCount = parseInt(playerCountInput.value, 10);
if (playerNames.length === 0) {
  for (let i = 0; i < playerCount; i++) {
    playerNames.push(`Player ${i + 1}`);
  }
  // Save default names to localStorage
  localStorage.setItem("playerNames", JSON.stringify(playerNames));
}

if (currentSubject) {
  showSelectedSubject();
  enableGenerateButton();
} else {
  generateBtn.disabled = true;
  generateBtn.textContent = "Select Subject First";
}

// Initialize the show player names button visibility
showPlayerNamesBtn.style.display = 'block';
playerNamesSection.style.display = 'none';

// Single event listener for the hide button
hidePlayerNamesBtn.addEventListener('click', () => {
  playerNamesSection.style.display = 'none';
  showPlayerNamesBtn.style.display = 'block';
});

// Single event listener for the show button
showPlayerNamesBtn.addEventListener('click', () => {
  playerNamesSection.style.display = 'block';
  showPlayerNamesBtn.style.display = 'none';
  updatePlayerNamesList();
});
</script>
</body>
</html>
